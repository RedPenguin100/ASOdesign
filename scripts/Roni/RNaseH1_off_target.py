import pandas as pd
import os
from consts import DATA_PATH_NEW
import pickle
import numpy as np
# =============================================== Off-target Function =================================================
from add_off_target_feat import get_off_target_feature
from asodesigner.fold import get_trigger_mfe_scores_by_risearch
from off_target_functions import dna_to_rna_reverse_complement, parse_risearch_output

def get_gene_seq(transcript_id, chromosome, sequences_path, annotation_path):
    # Read the annotation file
    with open(DATA_PATH_NEW/annotation_path, 'rb') as f1:
        gtf_dict = pickle.load(f1)
    print("read annotations")
    print(gtf_dict[transcript_id])

    # Read the relevant chromosomes
    with open(DATA_PATH_NEW/sequences_path, 'rb') as f2:
        seq_dict = pickle.load(f2)
    print("read sequences")

    # extract the gene's features
    start = gtf_dict[transcript_id]["start"]
    end = gtf_dict[transcript_id]["end"]
    strand = gtf_dict[transcript_id]["strand"]

    chrom_seq = seq_dict[chromosome]
    mRNA_seq = chrom_seq[start - 1: end]

    if strand == "-":
        return dna_to_rna_reverse_complement(mRNA_seq)
    else: # strand == "+"
        return mRNA_seq.replace("T", "U")

# Get RNAseH1 sequence:
# gtf_path = "cell_line_expression/_gtf_annotations_v34.pkl"
# seq_path = "cell_line_expression/chr_1_4.pkl"
# chrom = 'CM000664.2'
# RNaseH1_sequence = get_gene_seq("ENST00000315212.4", 'CM000664.2', seq_path, gtf_path)
# print(RNaseH1_sequence)

RNaseH1_premRNA_seq = "GGUGUUGAGCGCCGGCGGCUCGCGCCCACGCUGGGCCGGGAGUCGAAAUGCUUCCCGGUGCCGGGAGUGAGCGAUGAGCUGGCUUCUGUUCCUGGCCCACAGAGUCGCCUUGGCCGCCUUGCCCUGCCGCCGCGGCUCUCGCGGGUUCGGGAUGUUCUAUGCCGUGAGGAGGGGCCGCAAGACCGGGGUCUUUCUGACCUGGUGAGUGGCCCGCCCGCCGAGGCGCCUCCCUGCCGGCAUCGGGGUCGAGGGAGGCCGGAGCCCGGCUAACCCCGGCGGCGGGAGCCUGGCGGUCCGAGUCUGUGCCGCGCGCUGUGGCUGUGGGUGGUCGGGGGACCGCCUCGUUUUCCUGCUCGGCCGGCGGGGUUCCAGGAGGCUCAUGGCCUGGGACUGGAACGCACCGAAGACUUGUUUGAAAUAUCAGAAACGUCGCGUAAAGGUUAGGGGUGGCCUAAUAAACCCUGUGUUUAAUCCUCCAUCUUUGUUGCAGUUAAAGUGCAACAAAAAGUGACACGUAAUCAGAACGAACCCCCGUUACCAGAAGACUUUCCGUACCAGCUAAAUUGGGAUUGGAACUCAGUACCUAAUCUUCCCUUUUAAAAAAGGCAAAUUCUAAUAAGCCAGUAUUUGCAGUUGGAUCCUUGUAACAACCCUUGGAGGUGAGAGGGAUUAUUCUCACUUUCAGGUAUAGUUCUUGGGGUCAGGAAGUUCCCAGGGCAUGUAACUGACAGAGAAAGGACUUGAGCCCAGCUGUUCUGACUGUACCACCAGAACUCUUCCCACUACAAGAUACCAAAGUUCGUUACCUGUGUUUCCCCAUGCACGGCAGCUACAGUAUUGAGGAAGAAGCAUCUCAGAAGUUGACCUUUUUGUUGUAAAGAAAUGGUUAAUAUUUUUUUCAAAGACCGCAGUAUUUUGUUAUGCUUUGAGUUUGACGAAAGCCUUAUGGUGCUGGUGUGCUGGCUGGCUGGCAUACAGUAGAACACAGGUGUAGAGUCUGACGUGCAGGAUAAAACUAUAAGGUGCGACUCUGCCCUUUUCACGCAAAAAUUGGUCCUCUAUAUCCAGUUUGCAUCCUCAGUUUCAGCUAACCAUAGAUCAAAAAUAUUUGGAAAAAAUUAAAAUAGAAUACAGUUUUAAAAUACGCAUAAAAAGACAAUACAACUAUAUAGAUUGUAUUAGGUAUUAUAAACUAGAGAUGAUUUAAAGCAUGCAAGAAGAUGUGUGUGGGUUAUUUGCAAAUACACCAUUUUAUGCAAAGGACUUAAGCAUCCUCUGAUGUUGGUAUCUGUGAUGGGGUGGAGGACUUCCUGGAAUCAGUCUCCCUCAGAUACCAAGGGACAACUGUAUUUCCAACCUUAAGAAUCUCAAUAAAAAAGGGGAUAAGUUAGAGAAGGAAGAAGGAAAUAACAUUGCACAUCUUUUCCAGGAAUGAGUGCAGAGCACAGGUGGACCGGUUUCCUGCUGCCAGAUUUAAGAAGUUUGCCACAGAGGAUGAGGCCUGGGCCUUUGUCAGGAAAUCUGCAAGCCCGGAAGUUUCAGAAGGUAGUCACCUCUCAUAUCAGUGUGACAUUUUAACCUAUUCAAAGGCUUUCAUAUGCCAGAUGGCAUUUGAUCUAUAUAGCUACCCUCUAGGCAUGUAGGGAACCUCGUGUGAUUGUUUUCAUUUUACAAAUUAGGGAACAGACUGAAAGCAGUUACAAAUAGUGGUUCAUAUUACUUACAGUAUUAGGGAUAAGCCAGGACUCAGCUCUCCUGUUCCAUUCAGCCUUUUAUGCCAUAAUUCCUUGUCUUUUUUUAAAAAAAUACUUGUCCAGCCUGGCCAACAUGAUGAAACUCCAUCUCUACUAAAAUACAAAAAUUAGCUGGGCAUGGUGGCGCACACCUGUAAUCCCAGCUACUCGGGAGGCUGAGGUGGGAGAAUUGCUUGAGCCCGAGAAGUGGAGGCUACAGUGAGCCGAGAUUGCACCACUGCACUCCAGCCUGGGUGACAGGGCAAGACUCGUCAAAAAAAAAAAAAAAAAACUUACAUAGUUAUUGGACUGGAUGGGCUACAGUUUACAGGAAUGAGUGUGGUUCUUUCCAUGGCAUGCCCCUUUGUGGUGUUGCCUUUUUAUUGAGAACAGAGUCACACAAUCUGAAUUUCUUCUUUUUUUUUUUCCUUGAGACAGAGUCUCUGUUGCGCAGGCUGGAGUGCAGUGGCACAAUCUUGGCUCACUGCAGUCUCUGCCUCCUGCGUUCAAGCGAUUCUCCUGCUUCAGCUUCCGGAGUAGCUGGGAUUACAGGUGCGUGCCACCACGCCCGGCUAAUUUUUGUAUUUUUUUUAGUAGAGAUGGGAUUUCACCAUAUUGGCCAGGCUGGUCUUAAACACCUGACCUCAAAUGAUUCACCUGCUUUGGCCUCCCAAAGUGUUAGGAUUCCAGGCAUGAGCCACCACGCCUGUCCAAUUUCUUCCAAUUUUAUGUGUUAUAGAAAGUACGGUUAUUCAAAGUUUAAAGCCCAAUAUAAGAUUAAUUCCCAAUAUAAUUGGAAGUUUAAAGCCCAUUAUGCAGACUCAGAUGAGCAGGGUGACGACUUUAGAGCGCAAGAUUUUAAAAAUAUUUCUGGAUCUACACUGAGGAGGUGAUCUUACGUGAAUGUUACUUACAAACUUUUUACUAUAGCAAAUUAAGACUGAGCAGAGCAUAGUUUUAAUUACCUUAUCUUGAACAGCCUCUCUAGAGGCCACUGAGAUGCUUGAACCUGAACAACUGCUCCUUCGAAUCAUCGUAACAAUCCUGGACAAAGCACAAUUCAGAGCGAGGCAGGUUGUGUCCAGAAUGGAUCCCUGAAGAGUUAGUUUGCAAAGCAGGGUCGACCCUCACUCAGUGCAUCUGCUUCACCCUCUCUCUCUUCAAUAGCUUUUAAAGGAGAUUCUGUUUGAGAAUGAGGACACGUGAAAAAGGCUCAUCGAUGUGACAGUUCUUACUGCUUACUGCAUGACAGCCAAUAAGCUGAGAGACAAGGUGUUGGGGCAAGGAAGGCGACUUUUUUCCGAGAGCCAGCAAGUCAAGAAGAUGGUGGACUAGUGUCCUGAAGAACCAUCUUAAGUUAAUAGAACUUGAGACUUCUUUUAUGUUAAGGGAAGGGGAAAGAAAGGCGGAGGUGAGAUCAGGAGGAGACCGAUGAGCACAGACAUCUGGAUGGCAGCGAGGGUCCAAGGGGAUUGUGAAACUUCUCUGUCCUUGGUCAGGCCAUGAUGCUCCUCCUAUAAGUCUUCAACAUAACAUUGUUAUUUGUGUGUACUCCCUCUUUAUCUCCUUGGGGGUUAGUUUUGGGAACGGACCACUGUCAUCCUUGCUUUAAACUAUAAAUUCUUCCCAUAGUUCACUCGGCCUAUACGAUACCACUAUGGGGAUGUUAAGGGAGAAUGGAGGCAGUAAUGCUGAGCCGCCUCCUCGCUGUUACAGCUGUUCAUUUUUCUACCCAGAUGGAAAAAUCAGUUUGAGACAGAAAGCAGGUUUGAAAAUAUGGCUUUUUCCUUCUUUGCUGGGUUCCUGAUACUUCCUUUUCUUAAUUUUCCUUUUCAGUUUUCCUUUUCACAAAUUUUUUGUUUUUAACCAAUCAGUAAUUUAUUUGUAUCUCAAGUCUUCCAAUAUAAGUAUGUUUCUGUUUUUAUUAAGUACUCUGACUCUUAAAGCAAGCUAGUUCUUUUGAAUCUACUUCUUUAAACUUUAGAGACCUCCUAGUCAGUGACUUACGUCUAUAAAUUGAGAUUUAGUGCCUUUAAUGAUUCAGAUCUGUAUCAAAAAGUCUUAGCCCCUUUUACAGUUUUUUGUUUUUUAACAUUACAUUUAUCCUUAUUUUAGAAUUAUUGAGCUAUUUACUGGUUCUUAUGGUUUAUAUAAGCUGAUUUAAGGUUAAUUUACUUAAAAACCACAAUUUUGUGAAGUAAAACUUAACUGACAAGUGUGUUUUUUUCCUCCAAGUCUUAUCUGUUCUGUAAAGUGUCCAUCUCUGUUAUAGUAAGUAAAACCAGUGUUUAUAUCCGUGUUAAGGUUCUACAAAAUGACACUUUAACCUGGACCACAGUAUCUGCAUUUACUUCAGUAGAGUACCUAGAGGAACGUUUUGGAGAUGAGUGUGUGAAAACAAAAUGUGGCAGUGGAAACGCCAGCUGUUGCUGACGUCGUGCUGAUCACAGUCAAGUGUUGCCCGGCGCCCUUAGGGUUCCGAGAGGUGUGGGUUGAGAAGCUCCACUAGGCUGGACAUUUUCUUGUUCCUUUCUAGUAGGCGUUCUGUGAUGUUCGUGCCCCAUUUCUCCAUCCCUGGUUUAGGAGUUGAGAGCUGGAGGUGAAUCCUGUAGUGUUGGGUUAGGGUUGUUAGUUUGCAGGUAGUUGGUUGCUCCUGUGUCCUUAUUUUCACUCCAUGUAAGGAAAAGUCGUUUGAGAUCAUCUAGCCCAGGGCCUCGUUUUACAGAAGCCCAGAGGGUUUAAUUCAGUUGACGGAGUUCGCAGCUGAUAAAAGGUAUAGCACAAAUUGAAACUGGUUUUUUGAGUCCUGGUCUAAUUUAGCUGUUCUACUUCAGCUGCCAUAGUAUUACCCAGUGAGUGAGAUAUGGGCCCUUCCCAGAUAACCCUGAGGUGGUAUUAAGAAUCUCUUUGGGGCCGGGCGCAGCGGCUCACGCCUGUAAUCCCAGCACUGUGGGAGGUCAGGGCAGUGGAUCACAAGGUCAGGAGUUCAAGACCAGCCUGGCCAAAAUGGUGAAACCCCCAUCUCUACUAAAAAUACAAAAAAAUUAGCUGGGUGUGGUGGUGGGUGCCUGUAAUCCCAGCUACUUGGGAGGCUGUGGCAGAGAACUGCUUGAACCAGGGAGGUGGAAGUUGCAGUGAGCCACGAUCGCGCCACUGUACUCCAGCUUGGGCACAGAGCAAGACUCUGUCUCAAAAAAAAAAAACUAUUUGGGAUUAACCUUGAGGUCCCCCUGAAGAAAAACUUCGUUGCAGAAGAAAAACUUUGUUGCAAAAGAAAAGCUGCAAGAGUACUGACCCUGAAGGGACCCAGUUGCUUCCUUUUAGUUUCUGGUUUCUGUUUCCUUUUUUUUUUUGAGACAGAGUCUCACUCUCUCGCCCAGGCUGGAGUGCAGUGGCGCGAUCUCCGCUCACUGUAAGCUCCACCUCCUGGGUUCACACCAUUCUCCUGCCUCAGCCUCCUGAGUAGCUGGGAUUACAGGUGCCCGCCAUCACGCCUGGCUAAUUUUUGUAUUUUUAGUAGAGACAGGGUUUCACCAUGUUGACCAGGCUGGUCUUGAACUCCUGAGCUCAAAUGAUCUGCCCGCCUCGGCUUCCCAGCCCUGUUUUCCUUUCUUAAUAUGUCCCAUUAUCUGUUUAUUCAAGCUAGAUGAACCUGCACCCUCUGAGCCCUCCUAGGGGUUCUUAACUUCGUGUCCAUGUAGUUGUAUUUGAGGCAGGGAGAGGCUGAACCAUGGACACAACUCAUCUUUUUUUAGAUUUAUCUAUUUUUAAGCAAAGGGGUCUCACUAUGUUGGCCGGGUUGGAUUCAAACCCGGGCUCAAGCGAUACUCGUAUGUCAGCCUCCCGAGUAGCUGGAACUAUAGGCACACACCACUGCGCCCAGCAACACCACUGAUGUUAUAUACACAAUUUUGGGCCAUGUUUUUCCUGGAGAAAGAGCCCCUUGAGAUGCUGUGGAGGGGAUUGAGAUGCUGUGGAGGGGGUGGAGGUGGUGUGGAGGGGAGGGGGUGGUGGUGGUGUGGAGGGGAGGGGGUGGUGGUGGUGUGGAGGGGAGGGGGUGGAGGUGGUGUGGAGGGGGUGGAGGUGGUGUGGAGGGGGUGGAGAUGGCGUGGAGGGGGUGGAGAUGGCGUGGAGGGGGUCAUUCCCUCGUUUCCCUCGUUGUAGGGCCACAUAGAGAGGGUGUUUUUAAGUCUGAUUUAAUGAUACUAAAUAAUUUACUGAAUGUCUUCAUUCUCUAGCAUUUCGUGUUAUGUUCAUUGUUUCCAGCUCACGAGUGGACUCUUGUCUUUCAGGGCAUGAAAAUCAACAUGGACAAGAAUCGGAGGCGAAAGCCAGCAAGCGACUCCGUGAGCCACUGGAUGGAGAUGGACAUGAAAGCGCAGAGCCGUAUGCAAAGCACAUGAAGCCGAGCGUGGAGCCGGCGCCUCCAGUUAGCAGAGACACGUUUUCCUACAUGGGUACAUCUUCCUUGGGUUUUCAGAUUUUAAUACCACAGUCAGGAAAAUGUUAUGUGUAAAAGGUGUUUCCCACUUGAUGGGGGGAGUUUGAGCUGGUGUUUAUCAUCUUCAUUCUUAUGUGUAAAGAUUAUUUAGAAAUCACUAAGGCCAUUAUUUAUAAUCAAGUAGUGCAGAAUUAAACUUUUGGAUGUUCUUAGGAAAACCCUUACAUGUAAAUGAACAACUGUAAUCUUUUGAAAUACUAGUAUUCCCUGUGCAUGCAGUACUUAACGUUAAGAUGAAAUGCGAAGACUCCAGCUUUUUCAAAUAACACCUCACACGCAGCUGCUUGUUAUAAUUGAUUAGCACCAGCAUUUUAACCUUUCAUAUUCAAUCUUUGGAAAACAAGAGAUUCUAUUUUAUCCUGAGAAGCAAGGUAGUAGUGAACUUUUCUGCUACCUUUCACUCCAGGAAUCAGUUAUGUAUUUAGUGACUCACAGAAUAGAAUUCUCCUUUGUGUCUUUUACACAUAUGAGCAGAAAGUAGAAAUAAGCAUUAAAAAAUAUAAAUCAGUAUAUUUAUAGGUUCUAAUUUAAUUCAAGGGAAACCAGUAGAAAAUGUUUUGCCAAGCUGUAUUAUUUAUAGAUAUGUUUUGCAGUUACGUAAAAAAAGAUCAAACAAGUAUUCUUUAUUUGGUGAUUUACUAGUAGGAAUUGAAGCAAAGAUUUGUGGAGUUGCAGGGAGAUGAGCCGUUUCCAGACACUGACCAUUGCUGGAGGCUUGGUGGCCUGGAACAUGGCGGAUAGCAGGUGCUGGCUCCUGAGACAGUUCAGUGGCUGGGUGGGAAGCUUGUAGUCAUGCUGAUACAGUUAAGUUCCAGCUGAACGGAGGAGCCCUGCCCAACACCCACACUCCCCUUGGCUCUCAGCCCCGCUCCUGUGAGGAGCACAUCCCCAUCUUUGCCCCUUCGCCACUGCUGAGCUCAGUCUGCCGUCCUUCGGACAAGUACUUCCACUUCCUGCGCGUACCACCUCUAUUUGCCCUCUCGCCCAGCUCUUUUAACACUGUGCAACCUGACCUCUGAUCCCACCACACUACUGAAGUGUCCUGGUCACCAGUGGCCUGAGAAUGCCCCCGUCAGUCCUUUUUUACCUUGUUCUUUACAGCCUUUGUGUGUCAAUCAUACCCUCUAUCUAGAGGGAAAGAAGCAAAGACGGGAACCACACUUAACUAGCAGCAAAUAUGCCAGGGAAGAAAUUAGACCAGCACUGGUCAGGAGACUGGGCCCUCUGGCAGGCAGGGUCACCGUCAUGCUGAGGCGCUGCUCGUCUCUGGAGGAUGGCUCCCUGGGAGUGAAGGUGACCCUGCCGUGGAGACAGCGCCAUUGUCCUCUGAACCCACAGUGUGGGAUGUGAACAGUAGUUUUUACUGCAGCAGGCUCUAGUUUUACAAGGUGAUUGCCUUCACCCCGAACUUGCCUGGCCUGCAAGAUCAAAAUGUAAGUGGAUUCCAAGCAUAAAUGUUAGGUGCCCCCUUGUAAGGAAUGGAGCAUGUUUUCCUAGAGAGAAAACGUCUGCAGCGUUGUAAAAUACCCUCUCGGUUUAAAAUGCUAAGUCGACCUAGUGGAUUUUUGAGGUGAAUUUCAGUUUUUAGUAAGGUCAGCCCAGCAGCAUGUACUUCCUUUUCCCACAGGAGACUUCGUCGUCGUCUACACUGAUGGCUGCUGCUCCAGUAAUGGGCGUAGAAGGCCGCGAGCAGGAAUCGGCGUUUACUGGGGGCCAGGCCAUCCUUUGUAAGUUAAACGAAGCUGAGUUUUACUGAAUCAUGUUCCACAACUUGUGAAAAGAUGAGGCGGGAUCUGCUCAUUGUUUGAUUAUUGGGAAAACCUGCAGAUAAGUAGCUCUGGCAGGGGUGGCAGAGGAGCAGCUUUGGUUCGUGUUGGGGCUAAGCGGCAUUGCUUUUCAGAACGUGAGGUACCUCAGCUUUACUUCCUUUGCUUUUUUUUUUUUUUUUUUUUUUUUUAAGACACGGUCUCACACUGUUGCCCAGGAUGGAGUACAGUGGCACAAACACAGCUCACUGCAGACUUCACCUUCUGGGCUCAAGCGAUCCUCCCACCUUGGCCUCCCAAACUGUUGGGAUUAUGGGUGUGAGCCACUGCACCUGGCUUUGGUGUUUCUUUCUUGCCCUGGGGAGGAGUCUUUUUUUUUUUUUUUCCUGAGACGGAGUCUCACUCUAUCGCCCAGGCUAGAGUGCAGUGGCGCGAUCUCGGCUCACUGCAAGCUCCACUUCCCAGGUUCACGCCAUUCUCCUUCCUCACCCUCCCGAGUAGCUGGGACUACAGGCACCUGCCACCAGGCCCAGCUAAUUUUUUGUAUUUUUAGUAGAGACGGGGUUUCACCGUGUUAGCCAGGAUGGUCUCGAUCUUCUGACCUCGUGAUCCGCCCACCUCGGCCUCCCAAGAGGAGUCCUUUUUUCAGUAGAGAUGAAGUCUCACUAUGUUGCCCAGGCUGGGCUCAAAUUUCUGGGCUCAUGCGAUCCUCCCACCUUGUCCUCCCAAAGUGCCGAGAUCACAGGUGUGAGCCACCACCCCUGGCCCAAAAAUUGCUCAUUCUUUUAGGAAACUCUGGAUCUCCUGGUGACCCCAAAUUUUAAAUAACUUGUCUAAGGGUUUUUCUGGUUCCUUGAUUUCAUUUUCCUCUUUUACUUCCUGGAGGUUUUUAGUAGUUUCAAUCUGAAGUCUCACUCUCUCCAUUCUUCUUCCCGAGUUUUCUCCUGGGAUUCUUUCUGCUGCAGCCAUAGGGCCUAACCCAGGGUCCGCAGAGAACCAGCUUUUACUUCCUUUGCCCUAGUGGAACCCAUGAGAGUCAGAAGGUGCCCAAGUGUGGAAACCUGUGUGCUGCUCUCUGCUGGGAGUCUGUUAGUUUGAUUUUUAUAUGAUGCUUUUAUAUUUCAAAUAAGAAUACACACUAGUUUAUCGUUAUCCAUUAAGAAGAAUCACUUUGAGAAUUCACUUUAUACUUUUAUUUUCUUUUGUACUGUUUUGAAACAGAAAUGUAGGCAUUAGACUUCCUGGGCGGCAGACAAACCAAAGAGCGGAAAUUCAUGUAAGUUAUCAGAUACGUUUAAGCCUCUCUUUUUUGAGCAUUGAGUAUGAAAUUAUCAAAUAAACUAAUUCUUUUUUUUUCUACCUAUACAUAUAAGAUAUUUGAAGAGAGACGGGUUUAAUAACAAUUUUGAAAAAUAGGAAUUUUGUAGAAAAAUUCUAAAAACUUAUUUCAAAUAGAUGUCUACACAGGAGAAUUGUAUGUAUAGUAGUGUUUCAUACAGAGAAUAUAAUCAGUACAGAGGGGAUGUUUCAAUUUCGAAGUACUUUUGAACUUUAGUAAUGUCAGAGUUGAACAUUUUCUGUAGCAUGACUAUCGACUUGUCUUUUCAAGGCAGCCUGCAAAGCCAUUGAACAAGCAAAGACUCAAAACAUCAAUAAACUGGUUCUGUAUACAGACAGUAUGUUUACGAUAAAUGGUAAGCUUUCACAUUUGAUUUCUUCUGUUUUUCCAGUAACUGUGAAGGGAAAUUGGUAGGAGGUGUUGUAACAGGGCAGGACCCAAAUGGGAACGGGGGGAUGACAUUGGUUUGUCAGGUACCGAGCAAAGAGUGAGGAUUUUGGAGUCUCCCUUCUGCUGCUCUGAUGUUUUCCACAUGCUUAUUUCUUUGCCAGGCACUGGAGAUGCAGUCAGAAGUGGAAGUGGCUCUUACUUCUAGUCUGUGUGUGUAUAAGUCACUUAAGAUGGCGUGUUGACUGCUUCUUUGGGAAAUGCCCUGAAUAGGAGCAUGUAGGGGAUGCUUACGAGGCUGGGGAAGGCUCCUGGGAGAAAUGACAUCUUAAGCUGACAGCUGUAGGUAGAAUACAAGUUAGGGGAAAGGGAAGAGAGGAGGGUAUUUCAGGCUGUGCCAAAGGCCAAAGCAACUAAGGCCAGCUAAGGAAGUGAAGAGUCAAGGAUGGUGACUCAGAAUACAAGUGGGAUCAAUUAUAAGAGGUAAGACUAAGGAGGUGAAAAAGGCAGGACACUCAAGAUUGACUCACCAGUGAUCGUGCAUUUUUGUAGGUAUAACUAACUGGGUUCAAGGUUGGAAGAAAAAUGGGUGGAAGACAAGUGCAGGGAAAGAGGUGAUCAACAAAGAGGACUUUGUGGCACUGGAGAGGCUUACCCAGGGGAUGGACAUUCAGUGGGUGAGUAUCUUAAAUGUUCAUGUCCUAUGGCCAUUAUGACCAAAUAAGCUAAGUUUACUAGAGAUUAAUGGUUUAUGUAAGUGGUUUAAUGACAUAACAAUUUCCAUGAUAUUAAUAUCAUAAUGUAUAUUACAACGUAUUUGAGGCUGGGCGUAGUGGCUCACGCCUAUAAUCCCAGCACUUUGGGAGGCUGAGGUGGGUGGAUCACGAGGUCAGGAGUUCAAGACCAGCCUGGCCAGUAUGGUGAAACCCCAUCUUUAUUAAAAAAUACAAAAAUUAGCCGGGCAUGGUGGUGUGUGCCUGUAGUCCCAGCUACUCAGGAGGCUGAGGCAGGAGAAUCACUUGAACCCAGGAGGCGGAAGUUGCAGUGAGCUGAGAUCGCGCCACUGCACUCCAGCCUGAGCAACGAUAUGAGACUCCAAGACCCCGUCUCAAAAAAAAAAAAAAAAUAUGUGAGCCUGGGCUCAGUGGUUCACAUCUGUAACCCAGCACUUUAGGAGGCCCAAAUGGCCUGACUACUUAAGCCAAGAAGUUCGAGACCAGCCUGGAUAACAUGGGGAGACUCUGUUUCUCGAAAAAAUAAAAAAUUAGCCAGGGGUAGUGGCACAUGCCUGUAGUCUAGUUACUCAGGACACUGAGGUGGGAGGAUGACUUGAGCUGGGGAGGUCGAGGUUGCAGUGAGCCAAGAUUGUACCACUGUACUCUAGCCUGGGCGACAGAGUGAGACCCUGUCUCAGAAAAACAAAACAAACCCACCCACAUACACAAAUUUGAUUAUUUUCCUUAUCAUACAAGUAAUACAGUUUUUUGGUUUGGUUUUUGAGACAGGUCUCACUCUGUCACCCCAGGCUAUGGCGUGAUCUCAUUGCAACCUCUGCCUUCUGGGUUCAAGUGAUUCUCGUGCCUCAGCCUCCCAAGUAUCUGGGAUUACAGGCAUAUGCCACCACGCCUGGCUAAUUUUUGUAUUUUUAGUAGCGAUGGAGUUUUGUCAUGUUACCCAGGCUGGUCUUGAACUCUUGAUCUCAAACAUUCCACCUGCCUUGGCCUCUCAAAGUGCUGGGAUUACAUUUGUUUUGUGUCACUUCCUAUAUGUUUUUGUUUUAUGACAAAAAGGUUUACAACUAAAUCAAUAAUCAUGUCAAACUUUUUUUUAUUGUUUUGAGAUGGAGUCUCGCACUGUUGCCCAGGCUGGAGUGCAGUGGCGCAAUCUCGGCUCGCUGCAACCACAAGUAAUACAAUUCUAGUGAGAGUGUCACUAGGCAUAGAAUACACAGGCAGUGUGGUUUGAGGGAUGUUCUACAAUCCUUAUAUUUUGUUAAGAACACGAAGUAACACCCAACCUGGGCACAUGGCAUUACUAUGACAGCUGUAUGUCACCCUGUUCAUUUCUUUGGAAUGCAUCAUAAUGUUAAAUAAAACUAUCAGUGUAUUUUGUUUCAAACAAUAGUAAGGUUGUAUGAUUAAAGCCUUGGUAAUAGAACUUUUAUUCCAAGAUGGAAGCACUUUUUAAAAUCAUAGAUCAUGUUUAUUAAAAAGUUUUUUUCAAGCAAUAGAGAACAAAUUACACUGCAGCCACUGUCUCAACCCUGCCUUGUUCUGCCUUCCUGGAACCACUGAUAAUAGUUUGGUAGCCUGAUGUGUAAAUUUGCUUUGGCAACAUAAAUGUAAACAGUGGUUAAAUAAGUACAUUAUUUCUGACAGCACUGCAAGGGAAGCGUGUGUGUGUGUUGCAUACAUAUCCGUCCACCCAUCUGUACAUACAUGUGUUUUGCCUGGAAAGCUUAUCAAGUCCCAUUGAUAAGUGGGGAGGAAAUAGCAACAUGAACGGUAAAAUCCAAUUUGUGAAAAAACAAAAUGGAAUGUUCGUAAAUCACAUCCAUUGCGUAAACGCAUGAAGAAUGGACAGCGUGCUGUUGAGGAUCAUGUCUGGGGAGAGGAGCGUUGAAGUUGAGCUUAUGCUGUGCAGUCUGUUCUGAAUGGUUUUUUAUGAUGACAAUAUAGUCAUGUGUUGCUUAUGUAAAGAUGAGUAAAAAUAAAAGGAAAACAUUUAUCUUAACAGAUGCAUGUUCCUGGUCAUUCGGGAUUUAUAGGCAAUGAAGAAGCUGACAGAUUAGCCAGAGAAGGAGCUAAACAAUCGGAAGACUGAGCCAUGUGACUUUAGUCCUUGGGAGAACUUGAGCCAGCGGCUGUCUUGCUGCCUGUACUUACUGGUGUGGAAAAUAGCCUGCAGGUAGGACCAUUGCAGUGAUGGGCAGAUGCGUCUUUCACACGGAAUCAGGCACAGUGGCCUUCUGUGACAUGUGUUUAUAAAAAAUGGUUAAGUAUAUAAUAAAUUGAACAUCUUUGAGAUUGGAGAAUUAUGUGAGAUUUCCACAUUAUGUUUACUGGGUUCAAUACUGUCCUUGCUUGUUUUAUUGCAGGCAAGCAAGGCAAAUGGCCUAAAAUGCUGUGGCUUAUAUUUUGAUAAGAAAUCAAAAAACCAUUGGUUAAAAGAUGCAACUCAGAAGUCUGGAAGUAUUCUGAAAGCAUCCAUUUACCGUCCAGUUGACAGGUUUGAGUCUCCUGCUUGUAUAGGUGACUUGUGCCCAUGGGUACAUUAAAGGAACAUGCUGCCCAGGGCCUGGGCGGACAGCUCAGUGGGCAGGAUGUGUGCUGGGUCUCAGCCCCAUGUGCCUGCUUGCUGGGCAGUUAGUAUAGGGCAAAGCCUGCCUGCGGCGACCCUGGCUGCUAGGCCAUUCUCUAGGAACAGCUGCGACUCAUAAAGACCAAGAAGCAUAAAUAAACUUUCAAAAAUUUAUUUGGCUCUUUCGUUAAAAACUGUGCAAAUUAAAAAAAAAAAAAAAAAAGUAAGACACCGGCUGGGCACAGUGGCUCACUUCUGUAAUCCUAGCACUUUGGGAGGCCAAGGCGGGCAGAUCACUUGAGGUCAGGAGUUUGAGACCAGCUUGGCCAACAUGACGAAACCCUGUCUCUACUAAAAUUACAAAAAUUAUCCAGGUGUGGUGGCACGGGCUUGUAGUCCCAGCUACUUGGGAGGCUGAGGCACAAGAAUCACUUGAACCCAGGCGGCAGAGGUUGCAGUGAGCCAAGAUUGCACCACUGCACUCCAUCCUGGGCAACAGAGUGAGACUCUGUCUCAAAAAAAAAAAAAAGUAGUAAAAGUUUGACAUGAUUAUUUAUUUAGUUUUAAACCUUUUUAUUAUAAAAACAUACAGGAAGUGACACAAAACAAAUGUAUAGCUUAUUGAAUGAUUAUGAUUGUAAGGUGAAUAACCUUUGUGUCCACCACCUGGUGAAGAAAUAGUACUUUGCCAGAUACCCCAGGAGGCUCUCCCAAGUGCCCCUCCAGCCACAGCCCUCUUCUUCUCCCCCUCCUUGCCCCAACAAGUAAUCCUGACUUUUACAGAAAUGACUUUCUUGGUUUUUUGAUGGCAGUUUAGUCUUGUCUGCUUUUUUUUGUUUAUUUUUUUAUCUACUUCAGUGUCCAUUUGCAGUCCCGUCGGCCUCACUGUUUUCCCUGCCGUUUAUCUGUUGAAGAGCCUGGGCUGUUUGUCCCAUGGCUUCCCACAGUGUAGAUUUUGCUGACCACGUGGUCAUGGUGUAGUUCAGCAUGGUCCUCUAUGUUUCCUGCACAUUGGCAGCUGGGUCCAGAGGCUUGAUGAGCCUCAAAUUUGAUCCCUUUGGCAGGAGAACAGGCGGUUAGGAGCUUUCCUCAGGAAAGUACCAUGUUGACGGCAGCUGAUGCUCAGUGCCAAGAUCCAUUAAUUAUUUGGGGUUGCAAAAUGGUGGUAUUCUCAUUCUGUCGUUUUGCUUGCCUUUAUUAGCUGGAAUGGUUUUCUAAGAAAGUGUUUUCUUUUUUAUACUUAUCUGGUUACCCAGUGGUACAGUUCAUAUAGGAAGGGCAGGAUAAAUGCUUGAUUCUUUGCUCUUGUACACUAAGUUUUUAAGAUAAUGCAUUAGUUGUCUGUCAAGGAAGGUGAGUGGUGAAGGGUUUUUACAUAUAUACAAGAAUUCAUGGGCUGGGCAUGGUGUCUUAUGCCUGUAAUCCCAGCACUUUGGGAGGCUGAGGCUGGAGGAUCACAUGAACCCAGGAGUUUGAGACUAGUCUGGGCAACAUAGUGACACCCUGUCUCUACAGAAAAUUAAAAUAAAAUCAGGUGGGUGUGGUAGUGCCUGCCUGUUGUCCCAGCUAUUCUGGAGGCUGAGAUGGGAGGAUCGCUUGGGCCCAGGAGGUCGAGGAUGCGUGAGCUGUGACCAUGCCACCACAUUCCAGCCUGGGCGACAGCAAGUCCUUGUCUUAAAAAAAAAAAAGAAUUUGUGGAGUUAAGCAUACUUGGUGGGUUUCAAUCCGUUGUGAUUUUUAUCUUUAUUUAGCUCAGACUAGCUUAUUCGGUCAGUGAGAGGGAGCCUCUUCAGCUUGGCUCUUGCUUUCUUUUGAUAAGUGUGCACAUGUGUGCAUACAUGUGUGCACAGACCACACGCACAGUCAUUGAUAGCUCCCUGCAGCCUGGCAUGUCAAGAUGCUCUAGGCCCAAUUUAUAGAGCUUCUGCUCCAAACCUGUCUUAAAAGAAAAACUUUAGACAAGUUAGCAGUUUAAUUGAGCAGAAAAUAGUUUCUUCAGCUGGGUAGCACUCAGGACCAAAAGUGGUUCAGAACGUUCUCCUGUGCGUUGUGUGCAGGCUGUAUUUAUUUAUAGCCACAGGAAGGGAAAGACACAUGUACAUGGCCAGACUGACUGCAGGUCAGCCUCCACCUCACAUAGGCAUGUUUUGGGAGCCUUCAGCAUGUGAUUGGUGAGACUCUGCUGCUUGUUACAGAAGUGUACUCUCAAGUCAGGUCCCAGUUUGCUUAUACAUUAAGUGAGGUUAUAAGUCACUAUGUACAGAGGCAGUUUUAGGCCAAACUUAAUUCCGUUUAACACUUGGAAUCCAUUAUUUUUCCCAGAGUCUCUGGUAGAGAUGGUAUUUCAGAUCCAGUUUAGGAUGCUCAUUGCUAUUGCGUUGGUCAUUAUUUCUAGAUUUUUGGACGGAGCUUUAAAAAAAUACAAACAUUGCACACACAUAUUUAAAGGAAGAAUAUUUUCUGAGCCUAUAUUGAUAUUCCCAAUACAAAUUCAGGGUCCUGGGGCCUUUACAUAGCCUCCUCUAUAUGAUGUCUGUGUCUCCUGCACUCGGAAUCCUGCUUCUCAAGACACAGGACAAUGGCAUGGAAUAUCCAUCCCUUAAUCACUCACUUGUUUUAUUCCUCUUUAGCAUUUAGCAUUUAAAAAAAAUACUAAUACCAUAGCAUUAAUUGUGAUGAUGAAAACAGCACUGUGUCUACGUUGUCAGAAAAAUUGCUCCUUUUUACCACCAUUGACUCAUUUCUGUGUGUUCAGGUCUCAUAACCAGUCUAUAGUCAGUGUCAUCUUGGGGACAGUAUUCCUUGAGUUUCUGAUGUUGAAUUCAGUUUUGCUGGAUACGAAAUUCUUGGCCCAGAUUUUCUUUGAGUAUCUUGUUUUAUUCUGUUUUCUUCCAGCAUAAAGUGAUGCAUGAAAAGCCUGAUGAAUCUUGUUUUCUUCCCCUGACAGUCAUAUGCUGUUUUUCCUUAGAUGCCCAAAGGAUUUUUUCCUUUUUCUGUCAAGUCGGCCGUUUUAUUCGAAUGUGUCAUGUGUUGGUAUUGGUUGUCCUGGUCCAUAUUUGCAAGCGUAUGGUGUGCUCUUUCUAUGUGUACUUCAUAUCUGUUAUUUUAAGAAGAUUUGCUUGAACUGGAGUUUAGUGUUACAUUUUUCUUGCUUUGGCUUUUUUCUGUGGGGAUCCCUGUUAUCUGUAUGUUGAAAUCUAAAUUGGCUGUUCUCAGUGUUUGCCACUGUCUCUUGAAUCUCUUUUAUCUCUUUCUUUGUUUCUUUUUGAGUUUUAAAAGUUGUUAUUGUACCACUUUUGUUUUGUUUUGUUAUUUAAAAUAGGAACAGUGUCUCACUGUGUUGCCCAGGCUGGUCUUAAACUCCUGGCCUCAAGCGAUCCUCCUUCCUUGGCCUCCCAAAGUGCUGGGAUUACAGGUGUGAGCCACCAAAGCCGGCCCCACCUUGCUUUUUAAAACAGCUCUGUUGAGGUGUAACUGACAGGUAAUGAACUGCACAUACGUGAAGUGACCGAUGCAUUUGCCUGUGAAGCUGUCGCCAGAACAUGUCCAUCACCACCAACAGCAGUUUCACACCCCGGUCUAAACCGUCCCUCGUGUCCUCCAUGUUCAGGCAACCACUGGUCUGCUCCCUCUCACUAAAGGUUAAUUUAUAUAUUCUAGAAUUUUAUCUGAGUGGAAUCGCAGAGCAAGUACUGUGGGGGGAGGUGCUUCUACUCAGCAUAAUUAUUUUGGCAUUCACCCAUUUUGUGUACAUCAAUAAUCCACAUUUUGUAUUGCAUGGAUAUACCACAGUUUAUUUAUUUACCUGUUGACCGAUAUUUCGAUUAUUUCCAAUUUCUAAAUAAAAAUAAAGCAAAUAAAGCUGCCGUGAACAUUUA"

def off_target_specific_seq(ASO_df, seq_name, sequence, cutoff):
    index_score_vec = {}

    for idx, row in ASO_df.iterrows(): # For ASO

        index = row['index']
        ASO_seq = row['Sequence']
        trigger = dna_to_rna_reverse_complement(ASO_seq)
        name_to_seq = {seq_name: sequence}

        result_dict = get_trigger_mfe_scores_by_risearch(
            trigger,
            name_to_seq,
            minimum_score=cutoff,
            parsing_type='2'
        )
        result_df = parse_risearch_output(result_dict)

        RT = 0.616
        weights = np.exp(-RT * result_df['energy'])
        off_target_score = weights.sum()
        print(off_target_score)

        index_score_vec[index] = off_target_score
        # convert dict to DataFrame and save as CSV
    score_df = pd.DataFrame(list(index_score_vec.items()), columns=["index", "off_target_score"])
    score_df.to_csv(f"off_target_{seq_name}_{cutoff}.csv", index=False)

    return score_df


# May's DATA

may_df = pd.read_csv(DATA_PATH_NEW/"data_updated_inhibition.csv")

cutoffs = [0, 200, 400]
for cutoff in cutoffs:
    off_target_specific_seq(may_df, "RNaseH1", RNaseH1_premRNA_seq, cutoff)